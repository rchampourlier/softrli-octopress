
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>softr.li</title>
  <meta name="author" content="Romain Champourlier">

  
  <meta name="description" content="Let&#8217;s assume: you&#8217;re using RSpec for your tests,
you use Capybara for your integration/acceptance specs,
you run your tests in a Vagrant &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.softr.li">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="softr.li" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-27796788-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">softr.li</a></h1>
  
    <h2>Seeking and sharing about making IT softer</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.softr.li" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/08/capybara-selenium-rspec-vagrant-remotely/">Capybara Using Selenium, With RSpec, in the Vagrant (Remotely)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-08T12:00:00+01:00" pubdate data-updated="true">Nov 8<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Let&#8217;s assume:</h3>

<ul>
<li>you&#8217;re using RSpec for your tests,</li>
<li>you use Capybara for your integration/acceptance specs,</li>
<li>you run your tests in a Vagrant box.</li>
</ul>


<p>Let&#8217;s also say everything is working fine (I won&#8217;t deal with any issue you may have before this point).</p>

<p>Now, <strong>you have some features / user stories / whatever that requires some Javascript action</strong>.</p>

<h3>Well.</h3>

<p><strong>If you weren&#8217;t using Vagrant</strong>, I&#8217;d say everything should go fine too. Just append <code>:js =&gt; true</code> to your RSpec example, it will use Selenium and everything will go fine using your installed Firefox binary.</p>

<p>But <strong>you&#8217;re testing in a Vagrant box</strong>. So here&#8217;s what you&#8217;ll get:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Failure/Error: visit "/whatever"
</span><span class='line'>     Selenium::WebDriver::Error::WebDriverError:
</span><span class='line'>       Could not find Firefox binary (os=linux). Make sure Firefox is installed or set the path manually with Selenium::WebDriver::Firefox::Binary.path=</span></code></pre></td></tr></table></div></figure>


<h3>So you may say, fine, let&#8217;s install Firefox!</h3>

<p>But&#8230; your Vagrant box is meant to be <strong>used in headless mode</strong>, and Firefox requires something to draw on. Still, you may have it to work. But I&#8217;ll assume (again) that <strong>you don&#8217;t want to bother with setting things for the client-side of the test on the development/test box</strong> (which is more server-side) <strong>, and use everything that&#8217;s already on you real development machine</strong> (your day-to-day browsers).</p>

<p><em>If my assumption is false, you can have a look to <a href="http://www.without-brains.net/blog/2012/08/01/capybara-and-selenium-with-vagrant/">this article</a>, which explains both approaches (but not for RSpec, that&#8217;s the why of this article).</em></p>

<h3>The solution? selenium server!</h3>

<p>What you want is Capybara to use its selenium driver, but <strong>instead of running a local copy of the browser</strong>, use <a href="http://seleniumhq.org/download/">selenium server</a> which will <strong>allows Capybara to use browsers running in your real development machine</strong> (the host of your Vagrant development box).</p>

<h3>Ok I got it, how do I do it?</h3>

<p><a href="http://www.without-brains.net/blog/2012/08/01/capybara-and-selenium-with-vagrant/">This article</a> is pretty well made, with far more explanations that I provide, so I encourage you to have a look to fully understand how it works. However, <strong>it doesn&#8217;t provide the solution if you&#8217;re using RSpec</strong>, since it builds a simple <code>Unit::TestCase</code> example.</p>

<p><strong>This is where I truly do something.</strong></p>

<h3>Here&#8217;s how to get it working with RSpec (and even in Spork)</h3>

<p>Add this one line in your <code>spec_helper.rb</code> file (one line?!!!):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  require_relative 'support/capybara_remote'</span></code></pre></td></tr></table></div></figure>


<p>After the <code>require 'capybara/rspec'</code> would be great. If you&#8217;re using Spork, it should be in the <code>prefork</code> block.</p>

<p>Well, not truly a one-liner. Add this to a <code>spec/support/capybara_remote.rb</code> file too:</p>

<div><script src='https://gist.github.com/4038197.js?file='></script>
<noscript><pre><code># SELENIUM_SERVER is the IP address or hostname of the system running Selenium
# Server, this is used to determine where to connect to when using one of the
# selenium_remote_* drivers
SELENIUM_SERVER = &quot;10.10.11.1&quot;

# SELENIUM_APP_HOST is the IP address or hostname of this system (where the
# tests run against) as reachable for the SELENIUM_SERVER. This is used to set
# the Capybara.app_host when using one of the selenium_remote_* drivers
SELENIUM_APP_HOST = &quot;10.10.11.2&quot;

# CAPYBARA_DRIVER is the Capybara driver to use, this defaults to Selenium with
# Firefox
CAPYBARA_DRIVER = &quot;selenium_remote_firefox&quot;

# At this point, Capybara.default_driver is :rack_test, and
# Capybara.javascript_driver is :selenium. We can't run :selenium in the Vagrant box,
# so we set the javascript driver to :selenium_remote_firefox which we're going to
# configure.
Capybara.javascript_driver = :selenium_remote_firefox

RSpec.configure do |config|

  config.before(:each) do
    if selenium_remote?
      Capybara.app_host = &quot;http://#{SELENIUM_APP_HOST}:#{page.driver.rack_server.port}&quot;
    end
  end

  config.after(:each) do
    Capybara.reset_sessions!
    Capybara.use_default_driver
    Capybara.app_host = nil
  end

  # Determines if a selenium_remote_* driver is being used
  def selenium_remote?
    !(Capybara.current_driver.to_s =~ /\Aselenium_remote/).nil?
  end
end

# Set the default driver to CAPYBARA_DRIVER, when you change the driver in one
# of your tests resetting it to the default will ensure that its reset to what
# you specified when starting the tests.
#Capybara.default_driver = CAPYBARA_DRIVER.to_sym

# CapybaraDriverRegistrar is a helper class that enables you to easily register
# Capybara drivers
class CapybaraDriverRegistrar

  # register a Selenium driver for the given browser to run on the localhost
  def self.register_selenium_local_driver(browser)
    Capybara.register_driver &quot;selenium_#{browser}&quot;.to_sym do |app|
      Capybara::Selenium::Driver.new(app, browser: browser)
    end
  end

  # register a Selenium driver for the given browser to run with a Selenium
  # Server on another host
  def self.register_selenium_remote_driver(browser)
    Capybara.register_driver &quot;selenium_remote_#{browser}&quot;.to_sym do |app|
      Capybara::Selenium::Driver.new(app, browser: :remote, url: &quot;http://#{SELENIUM_SERVER}:4444/wd/hub&quot;, desired_capabilities: browser)
    end
  end
end

# Register various Selenium drivers
CapybaraDriverRegistrar.register_selenium_remote_driver(:firefox)</code></pre></noscript></div>


<p>Be sure to adjust the constants (<code>SELENIUM_SERVER</code>, <code>SELENIUM_APP_HOST</code>, <code>CAPYBARA_DRIVER</code>) to match your configuration (as explained in the comments).</p>

<p>Now, get the selenium server <code>.jar</code> and run it on your real machine (the host of your Vagrant) with this command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>java -jar selenium-server-standalone-2.25.0.jar </span></code></pre></td></tr></table></div></figure>


<p>Now, any RSpec example with the <code>:js =&gt; true</code> metadata should be running in your Firefox browser on your real machine, where you can see it!</p>

<h3>Wrapping up</h3>

<p>We&#8217;ve seen how to use <strong>selenium server</strong> to allow <strong>Capybara</strong> running in a <strong>Vagrant box</strong> to use the host&#8217;s <strong>browsers</strong> to run <strong>RSpec</strong> specs requiring <strong>Javascript</strong>.</p>

<h3>References</h3>

<ul>
<li><a href="http://www.without-brains.net/blog/2012/08/01/capybara-and-selenium-with-vagrant/">the main source for my custom configuration</a></li>
<li><a href="http://jeffkreeftmeijer.com/2011/capybara-ate-swinger/">more on how capybara allows to select a driver from the examples in RSpec</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/19/image-cropping-with-live-preview-in-rails/">Cropping With Live Preview in Rails, Using Jcrop</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-19T11:50:00+02:00" pubdate data-updated="true">Oct 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Well, thanks to the <a href="http://railscasts.com/episodes/182-cropping-images">Jcrop Railscast</a>, I had setup <strong>avatar upload and cropping features</strong> on <a href="http://www.avdice.com">our project</a>.</p>

<p>With the major changes coming in our next release, this little feature <strong>wasn&#8217;t working anymore</strong>, and I couldn&#8217;t figure why my preview was working like a mess&#8230;</p>

<p>I looked into the code, which matches the <a href="http://deepliquid.com/projects/Jcrop/demos.php?demo=thumbnail">Jcrop&#8217;s original example</a>, but I couldn&#8217;t figure what was wrong! Wow, but that&#8217;s a pretty simple thing, no? Just scaling and offsetting a picture, shouldn&#8217;t take long to understand?!</p>

<p>Well, the code wasn&#8217;t looking good enough. I&#8217;m undertaking <a href="https://www.edx.org/courses/BerkeleyX/CS169.1x/2012_Fall/about">edX SAAS course</a> so I want my code to be <em>beautiful</em>. So, let&#8217;s rewrite it!</p>

<h3>The context</h3>

<ul>
<li>I want a <strong>simple cropping feature</strong>, using Paperclip just like the one setup in the Railscast, and the <strong>live preview</strong>.</li>
<li>I just need to crop to a <strong>square picture</strong>.</li>
<li>I want it to work!</li>
</ul>


<p>I won&#8217;t rewrite the whole tutorial, since the Railscast is perfect to setup your model with Paperclip, add the cropper module, but the Javascript with preview was a wreck, and that&#8217;s what I rewrote.</p>

<h3>The Javascript</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>:javascript
</span><span class='line'>  
</span><span class='line'>  var previewSize = 150;
</span><span class='line'>  var originalSize = {
</span><span class='line'>    width: #{@user.avatar_geometry(:original).width},
</span><span class='line'>    height: #{@user.avatar_geometry(:original).height}
</span><span class='line'>  };
</span><span class='line'>
</span><span class='line'>  function updatePreview(coords) {
</span><span class='line'>    var ratio = previewSize / coords.w;
</span><span class='line'>    
</span><span class='line'>    $('#preview').css({
</span><span class='line'>      width: Math.round(originalSize.width * ratio) + 'px',  
</span><span class='line'>      height: Math.round(originalSize.height * ratio) + 'px',  
</span><span class='line'>      marginLeft: '-' + Math.round(coords.x * ratio) + 'px',  
</span><span class='line'>      marginTop: '-' + Math.round(coords.y * ratio) + 'px'  
</span><span class='line'>    });
</span><span class='line'>
</span><span class='line'>    $('#profile_crop_x').val(Math.floor(coords.x));  
</span><span class='line'>    $('#profile_crop_y').val(Math.floor(coords.y));  
</span><span class='line'>    $('#profile_crop_w').val(Math.floor(coords.w));  
</span><span class='line'>    $('#profile_crop_h').val(Math.floor(coords.h));    
</span><span class='line'>  };
</span><span class='line'>
</span><span class='line'>  $(function() {
</span><span class='line'>    $('#cropbox').Jcrop({
</span><span class='line'>      onChange: updatePreview,  
</span><span class='line'>      onSelect: updatePreview,  
</span><span class='line'>      setSelect: [0, 0, originalSize.width * 0.9, originalSize.height * 0.9],  
</span><span class='line'>      aspectRatio: 1
</span><span class='line'>    });
</span><span class='line'>  });</span></code></pre></td></tr></table></div></figure>


<p>I think this version makes more sense, and in my case it works perfectly. I used some drawings to help me rewriting this, so you may find it helpful, in particular if you want something to start with if you don&#8217;t just want a square target size!</p>

<p><img src="https://s3-eu-west-1.amazonaws.com/softrli/assets/2012-10-19-image-cropping-with-live-preview-in-rails-asset-1.png" alt="" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/08/softrli-build-own-icon-font/">Build Your Very Own Icon Font</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-08T22:50:00+02:00" pubdate data-updated="true">Aug 8<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I intend to give you <strong>the fastest road to your own icon font</strong>. How fast?</p>

<ol>
<li>You find SVG files of the icons you want in your set. Except giving you some sources to find them (which I do), I&#8217;m afraid I can&#8217;t save you this step.</li>
<li>Use the magic of <a href="http://keyamoon.com/icomoon/app">IcoMoon</a>, an HTML5 application brought to you by Keyamoon, to <strong>package all these icons in a set of fonts, CSS and JS</strong>. Once this is done, you&#8217;re ready to use your brand new custom icon font!</li>
<li>That&#8217;s true, no step 3!</li>
</ol>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/08/08/softrli-build-own-icon-font/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/07/setup-development-environment-with-vagrant/">Setup Development Environment With Vagrant</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-07T21:00:00+02:00" pubdate data-updated="true">Aug 7<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Install Vagrant</h3>

<p>First, we want to install Vagrant on our development machine. Go to <a href="http://vagrantup.com/">the Vagrant website</a> and download the latest binaries for your OS. If there is no binary package available, you can install it through Rubygems using <code>gem install vagrant</code>, but Vagrant&#8217;s guide tells us binaries are the best choice.</p>

<h3>Download your first Vagrant virtual machine</h3>

<p>To build its development environments, Vagrant relies on Virtual Box virtual machines with a barebones OS installation. We will work with the common Ubuntu 10.04.3 LTS, also known as Lucid Lynx. So we have to download the corresponding Vagrant box, which is done by:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant box add lucid32 http://files.vagrantup.com/lucid32.box</span></code></pre></td></tr></table></div></figure>


<p>This box is a fully functional Ubuntu Lucid machine with 512MB of RAM. As soon as the command ends, we&#8217;re ready to go on.</p>

<p><em>Note that if you are already using Vagrant and added this box before, you should already be ready for the next part.</em></p>

<h3>Configuring the project to use the Vagrant box</h3>

<p>Go to your project&#8217;s directory, and run this to init Vagrant with the project:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant init lucid32</span></code></pre></td></tr></table></div></figure>


<p>This will create the Vagrant&#8217;s configuration file, <code>Vagrantfile</code>. The generated files contains already lots of commented commands to setup the configuration. For now, we replace this all by this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Vagrant::Config.run do |config|
</span><span class='line'>  config.vm.box = "lucid32"
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<h3>Run the Vagrant box</h3>

<p>Run <code>vagrant up</code> to setup and start the virtual machine. It can&#8217;t do much for now, but it starts! If everything is good, you should see this finish message:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[default] VM booted and ready for use!
</span><span class='line'>[default] Configuring and enabling network interfaces...
</span><span class='line'>[default] Mounting shared folders...
</span><span class='line'>[default] -- v-root: /vagrant</span></code></pre></td></tr></table></div></figure>


<p>However, if the process seems to stop on <code>[default] Waiting for VM to boot. This can take a few minutes.</code> you may have the same issue I had with Vagrant not achieving to connect to the virtual machine with the default network configuration (NAT). There is <a href="https://github.com/mitchellh/vagrant/issues/455">an issue on Github</a> related to this problem. The cause of this issue is currently unclear, but on my system adding this to the <code>Vagrantfile</code> has made it work without any hickup for several months:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Tries to fix issue #455
</span><span class='line'>  config.vm.customize ["modifyvm", :id, "--rtcuseutc", "on"]
</span><span class='line'>  config.ssh.max_tries = 10</span></code></pre></td></tr></table></div></figure>


<h3>Preparing the environment</h3>

<p>From now, the box you installed is not provisionned with any server software. To do so, the best way is to have built a set of Chef or Puppet recipes (or cookbook) that you will specify into <code>Vagrantfile</code>. Doing so, <code>vagrant up</code> will provision the required environment in one single step. We won&#8217;t cover this subject in here, since it focuses on setting up Vagrant itself. If you want some help to setup Chef for example, I wrote several articles on the subject, check <a href="http://www.softr.li/blog/categories/vagrant/">the vagrant category</a>.</p>

<h3>References</h3>

<p><a href="http://docs.puppetlabs.com/puppet_core_types_cheatsheet.pdf">http://docs.puppetlabs.com/puppet_core_types_cheatsheet.pdf</a>
<a href="https://github.com/example42/puppet-modules">https://github.com/example42/puppet-modules</a>
<a href="http://www.example42.com/">http://www.example42.com/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/25/postgresql-schema-owner-altered-during-dump-prevent-access-from-rails/">PostgreSQL Schema&#8217;s Owner Altered in Database Dump Preventing Rails From Finding the Data</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-25T15:40:00+02:00" pubdate data-updated="true">Jul 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is more a note-to-myself post, but if someone falls in the same hole, this may be helpful as I couldn&#8217;t found any help on this on the web&#8230;</p>

<p>I have a Rails application whose database is regularly backed up (thanks to the <a href="https://github.com/meskyanichi/backup/">Backup gem</a>). While updating my development environment (which is under Vagrant) and trying a migration to Rails 3.2, I was bitten by a hard-to-debug <strong>issue involving PostgreSQL schemas</strong>.</p>

<p>After creating the db (with <code>rake db:create</code>) and before loading the dump (using <code>psql -d app_development -f app.sql</code>), everything was fine: Rails could find the tables, tell which schema it was working on (returning <code>public</code> when running <code>ActiveRecord::Base.connection.current_schema</code> in the console).</p>

<p>However, as soon as I loaded the dump file, Rails could not find the data anymore (more precisely the schema). It could still access the database itself, but not the schema. Related issues were:</p>

<ul>
<li>Rails keeping saying <code>...(Table doesn't exist)</code>,</li>
<li>or a more significative <strong><code>PG::Error: ERROR:  no schema has been selected to create in</code></strong> when running <code>rake db:migrate</code>.</li>
</ul>


<p>The culprit was this line in the <code>app.sql</code> dump file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ALTER SCHEMA public OWNER TO postgres;</span></code></pre></td></tr></table></div></figure>


<p>The schema&#8217;s owner was changed to <code>postgres</code>, while Rails was trying to access it as another user (the database&#8217;s owner).</p>

<p>I just changed <code>postgres</code> to match my database name, and it worked again. Be sure to check your schema&#8217;s owner if you meet these issues!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/21/running-guard-over-vagrant/">Running Guard Over Vagrant</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-21T18:05:00+02:00" pubdate data-updated="true">Jul 21<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>To keep it simple, you can&#8217;t&#8230; do it properly. File events are not correctly triggered by VirtualBox on the guest when the files are updated from the host (see the related Github <a href="https://github.com/guard/listen/issues/53">issue</a>). So <strong>guard cannot detect the events issued by the host</strong>&#8230; unless you run it with the polling option:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant -p</span></code></pre></td></tr></table></div></figure>


<p>This polling option works correctly on the latest versions of VirtualBox (there was an <a href="https://github.com/guard/guard/issues/269">issue</a> before 4.1.12), but it remains a bad option because doing so my <strong>system&#8217;s CPU instantly goes to a constant 100% charge</strong>.</p>

<p>To <strong>improve the situation</strong>, you can still <strong>reduce the latency</strong> so that the polling is not done so frequently. This naturally adds some delay before the triggering of the events, but it will keep your system cool.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>guard -p -l 10</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/21/softrli-update-virtual-box-guest-additions/">How to Update VirtualBox Guest Additions on a Vagrant Virtual Machine</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-21T18:00:00+02:00" pubdate data-updated="true">Jul 21<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>How to</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -c http://download.virtualbox.org/virtualbox/4.1.18/VBoxGuestAdditions_4.1.18.iso
</span><span class='line'>sudo mount VBoxGuestAdditions_4.1.18.iso -o loop /mnt
</span><span class='line'>sudo sh /mnt/VBoxLinuxAdditions.run --nox11</span></code></pre></td></tr></table></div></figure>


<p>At this point, <strong>you may encounter an error</strong> saying you need to specify <code>KERN_dir</code>. I spent some time finding what was required, finally after running all the following package installations it worked!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install linux-headers-generic
</span><span class='line'>sudo apt-get install dkms gcc
</span><span class='line'>sudo apt-get install linux-headers-2.6.32-38-generic</span></code></pre></td></tr></table></div></figure>


<p>I assume the most important is <code>dkms</code> and the appropriate <code>linux-headers-...</code> package. <strong>Check the log message</strong> provided with the error, it may indicate which package version has to be installed.</p>

<p><strong>Do not worry for the <code>Installing the Window System drivers ...fail!</code></strong> error message, this is no issue we have no window system on a vagrant box.</p>

<h4>References</h4>

<ul>
<li><a href="http://till.klampaeckel.de/blog/archives/155-VirtualBox-Guest-Additions-and-vagrant.html">till.klampaeckel.de/blog/archives/155-VirtualBox-Guest-Additions-and-vagrant.html</a></li>
<li><a href="http://ubuntuforums.org/showthread.php?t=1684185">ubuntuforums.org/showthread.php?t=1684185</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/15/sinatra-guard-shotgun/">Faster Sinatra Development With Guard-shotgun</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-15T18:20:00+02:00" pubdate data-updated="true">Jul 15<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.sinatrarb.com/">Sinatra</a> is a really nice way to <strong>bootstrap projects</strong>. It allows to <strong>start really fast</strong>, and is really suited for <strong>API-based</strong> projects (may be a good choice for your next mobile-or-web-app backend).</p>

<p>Unlike Ruby on Rails however, Sinatra does not reload your code with each request, so you have to restart the server each time your code changes. To help you with this burden, there is a small tool called <a href="https://github.com/rtomayko/shotgun">Shotgun</a>.</p>

<p>I&#8217;ve used it but I rapidly faced a <a href="https://github.com/rtomayko/shotgun/issues/34">logging issue</a> making it useless.</p>

<p>Since I was using <strong>the excellent <a href="https://github.com/guard/guard/">Guard</a></strong>, and I had already seen a similar reloading module for Webrick, I just decided to code <a href="https://github.com/rchampourlier/guard-shotgun">guard-shotgun</a>. It&#8217;s a fairly simple <strong>plugin for Guard</strong> providing the <strong>same feature as Shotgun</strong>, but using the rock-solid fundation provided by Guard!</p>

<p>Feel free to use, fork, and even feedback it!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/05/setup-automatic-clearing-of-your-rails-sessions/">Setup Automatic Clearing of Your Rails Sessions</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-05T09:40:00+02:00" pubdate data-updated="true">Jul 5<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>With every connection to your application of a new user, bot or whatever, Rails will create a new session object.</p>

<p>If you&#8217;re using <a href="http://api.rubyonrails.org/classes/ActiveRecord/SessionStore.html">ActiveRecord::SessionStore</a> to save your sessions in your database, your database may already be alarmingly growing in size, due to the number of sessions it contains.</p>

<h3>The rake db:sessions:clear task</h3>

<p>If you don&#8217;t mind a lot about your users loosing their session, you can simply use the provided <code>rake db:sessions:clear</code> task. It will simply delete all sessions in the database. Side-effect: all current sessions are deleted, so signed in users get signed out, and you should hope they had nothing under way!</p>

<h3>A more user-friendly solution</h3>

<p>Writing a simple rake task to replace the default one and only remove sessions older than 2 weeks is as easy as adding this file to your project:</p>

<figure class='code'><figcaption><span>lib/tasks/sessions.rake  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">namespace</span> <span class="ss">:sessions</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Clear expired sessions (more than 2 weeks old)&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:cleanup</span> <span class="o">=&gt;</span> <span class="ss">:environment</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM sessions WHERE (updated_at &lt; &#39;</span><span class="si">#{</span><span class="no">Date</span><span class="o">.</span><span class="n">today</span> <span class="o">-</span> <span class="mi">2</span><span class="o">.</span><span class="n">weeks</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
</span><span class='line'>    <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if you run <code>rake sessions:cleanup</code>, only the older sessions will be removed from your database.</p>

<h3>Last but not least: automation</h3>

<p>So that you don&#8217;t have to run it every day, you can setup a cron task to do it for you. Here is the line we use:</p>

<figure class='code'><figcaption><span>crontab </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># m h  dom mon dow   command
</span><span class='line'>01 3 * * * bash -l -c 'cd /home/deployer/rails/project/current; bundle exec rake sessions:cleanup'</span></code></pre></td></tr></table></div></figure>


<h3>References</h3>

<ul>
<li><a href="http://blog.brightbox.co.uk/posts/clearing-out-rails-sessions">http://blog.brightbox.co.uk/posts/clearing-out-rails-sessions</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/20/which-html5-canvas-javascript-library-should-i-use/">Which HTML5 Canvas Javascript Library Should I Use?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-20T12:35:00+02:00" pubdate data-updated="true">Jun 20<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m looking for an HTML5 Canvas library which I could use to build an interactive and animated UI control. So my requirements are essentially:</p>

<ul>
<li>well <strong>documented</strong>, <strong>supported</strong> and <strong>maintained</strong> library, because I want to be able to reuse it in later projects,</li>
<li>easing the process of creating <strong>complex graphical objects</strong> (my control is going to be quite complex, a lot more than a simple button), if possible supporting groups and layers,</li>
<li>helping me with the handling of <strong>user interactions</strong>,</li>
<li>supporting <strong>touch devices</strong>,</li>
<li>providing tools for <strong>animating</strong> the graphical content.</li>
</ul>


<p>I&#8217;ve searched for the appropriate library, so I will share with you the results of my search. After a list of most of the available libraries, I investigated the following shortlist of libraries: <strong>EaselJS</strong>, <strong>fabric.js</strong>, <strong>Paper.js</strong>, <strong>processing.js</strong> and <strong>Kinetic.js</strong>. I hope this can help you with your own choice!</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/06/20/which-html5-canvas-javascript-library-should-i-use/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section>
  <h1>About Me</h1>
  <div id="twitter-profile" style="margin-top:0.5em;">
    <strong><p>Romain Champourlier</p></strong>
    <p>The geeky-tech-dev blog of Romain Champourlier, French engineer and entrepreneur.</p>
  </div>
  <script type="text/javascript">
    $.domReady(function(){
        var container = $('#twitter-profile'),
            user = "softrli";
            
        $.ajax({
            url: "http://api.twitter.com/1/users/show.json?include_entities=false&screen_name="+user+"&callback=?"
          , type: 'jsonp'
          , error: function (err) { $('#twitter-profile').addClass('error');  }
          , success: function(data) {
              container.html('<img class="left" src="http://api.twitter.com/1/users/profile_image/'+user+'.json?size=bigger" alt="@'+user+'"><p><strong>'+data.name+'</strong><br/>('+data.location+')</p><p>'+data.description+'</p>');
            }
        })
      });
  </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("softrli", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/softrli" class="twitter-follow-button" data-show-count="true">Follow @softrli</a>
  
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/11/08/capybara-selenium-rspec-vagrant-remotely/">Capybara using Selenium, with RSpec, in the Vagrant (remotely)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/19/image-cropping-with-live-preview-in-rails/">Cropping with live preview in Rails, using Jcrop</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/08/softrli-build-own-icon-font/">Build your very own icon font</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/07/setup-development-environment-with-vagrant/">Setup development environment with Vagrant</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/25/postgresql-schema-owner-altered-during-dump-prevent-access-from-rails/">PostgreSQL schema&#8217;s owner altered in database dump preventing Rails from finding the data</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/rchampourlier">@rchampourlier</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rchampourlier',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Romain Champourlier -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'softrli';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
